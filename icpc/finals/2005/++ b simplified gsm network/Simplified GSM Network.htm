<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"><title>3270 - Simplified GSM Network</title></head><body><table align="center" border="1" cellpadding="3" cellspacing="0"><tbody><tr valign="center"><td rowspan="2" align="center" valign="center"><font color="#0000a0" size="5"><b><img src="Simplified%20GSM%20Network_files/icono.gif"></b></font></td><td colspan="5" align="center" width="500"><font color="#0000a0" size="5"><b>3270 - Simplified GSM Network</b></font><br><a href="http://acmicpc-live-archive.uva.es/nuevoportal/region.php?r=wfi&amp;year=2004"><b>World Finals - Shanghai - 2004/2005</b></a></td></tr><tr valign="center"><td align="center" width="100"><a href="http://acmicpc-live-archive.uva.es/nuevoportal/data/p3270.pdf"><b>PDF</b></a></td><td width="100">&nbsp;</td><td align="center" width="100"><a href="http://acmicpc-live-archive.uva.es/nuevoportal/mailer.php?problem=3270"><b>Submit</b></a></td><td width="100">&nbsp;</td><td align="center" width="100"><a href="http://acmicpc-live-archive.uva.es/nuevoportal/rankprob.php?p=3270"><b>Ranking</b></a></td></tr></tbody></table><p>&nbsp;</p>
<p>
Mobile phones have changed our lifestyle dramatically in the last decade. Mobile phones have a variety of protocols 
to connect with one another. One of the most popular networks for mobile phones is the GSM (Global System for 
Mobile Communication) network.  

</p><p>

</p><p>
<br>
In a typical GSM network, a mobile phone connects with the nearest BTS (Base Transceiver Station). A BSC (Base
Station Center) controls several BTSs. Several BSCs are controlled by one MSC (Mobile Services Switching 
Center), and this MSC maintains a connection with several other MSCs, a PSTN (Public Switched Telecom 
Network) and an ISDN (Integrated Services Digital Network).  

</p><p>

</p><p>
<br>
This problem uses a simplified model of the conventional GSM network. Our simplified network is composed of up
to fifty BTS towers. When in use, a mobile phone always connects to its nearest BTS tower. The area covered by a 
single BTS tower is called a cell. When an active mobile phone is in motion, as it crosses cell boundaries it must 
seamlessly switch from one BTS to another. Given the description of a map consisting of cities, roads and BTS 
towers, you must determine the minimum number of BTS switches required to go from one city to another. 

</p><p>
</p><div align="center">
<!-- MATH
 $\epsfbox{p3270.eps}$
 -->
<img src="Simplified%20GSM%20Network_files/p3270.jpg" alt="\epsfbox{p3270.eps}" align="bottom" border="0">
</div>
<p>
</p><div align="center"><b>Figure:</b>  Cities here are represented by squares and BTS towers by trapezoids.
Solid lines are roads. The dotted lines show 9 different cells. The minimum
number of switches required to go from city 1 to city 6 is (2+1+0)=3. Note
that city 7 is isolated and cannot be reached.

</div>

<p>
Each tower and each city location is to be considered as a single point in a two-dimensional Cartesian coordinate 
system. If there is a road between two cities, assume that the road is a straight line segment connecting these two 
cities. For example, in the figure, traveling on the road from city 1 to city 2 will cross two cell boundaries and thus 
requires two switches. Traveling from city 2 to city 5 crosses one cell boundary and traveling from city 5 to city 6 
requires no switch. Traveling this route from city 1 to city 6 requires three total switches. Note than any other path 
from city 1 to city 6 requires more than three switches. If there is more than one possible way to get from one city to 
another, your program must find the optimal route. 

</p><p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001001000000000000000">
Input</a>&nbsp;</font>
</h2> 

<p>
The input file contains several test cases. The first line of each test case contains four integers: <!-- MATH
 $B (1 \le B \le 50)$
 -->
<span class="MATH"><i>B</i>(1<img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>B</i><img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18">50)</span>,
the number of BTS towers; <!-- MATH
 $C (1 \le C \le 50)$
 -->
<span class="MATH"><i>C</i>(1<img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>C</i><img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18">50)</span>, the number of cities; <!-- MATH
 $R (0 \le R \le 250)$
 -->
<span class="MATH"><i>R</i>(0<img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>R</i><img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18">250)</span>, the number of roads;
and <!-- MATH
 $Q (1 \le Q \le 10)$
 -->
<span class="MATH"><i>Q</i>(1<img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>Q</i><img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18">10)</span>, the number of queries. Each of the next <span class="MATH"><i>B</i></span> lines contains two floating-point numbers <span class="MATH"><i>x</i></span> and <span class="MATH"><i>y</i></span>,
the Cartesian coordinates of a BTS tower. Each of the next <span class="MATH"><i>C</i></span> lines contains two floating-point numbers <span class="MATH"><i>x</i><sub>i</sub></span>, <span class="MATH"><i>y</i><sub>i</sub></span>
that indicate the Cartesian coordinates of the <span class="MATH"><i>i</i></span>th city <!-- MATH
 $(1 \le i \le C)$
 -->
<span class="MATH">(1<img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>i</i><img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>C</i>)</span>. Each of the next <span class="MATH"><i>R</i></span> lines contains two
integers <span class="MATH"><i>m</i></span> and <span class="MATH"><i>n</i></span> <!-- MATH
 $(1 \le m,n \le C)$
 -->
<span class="MATH">(1<img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>m</i>, <i>n</i><img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>C</i>)</span>, which indicate that there is a road between the <span class="MATH"><i>m</i></span>-th and the <span class="MATH"><i>n</i></span>-th city.
Each of the next <span class="MATH"><i>Q</i></span> lines contains two integers <span class="MATH"><i>s</i></span> and <span class="MATH"><i>d</i></span> <!-- MATH
 $(1 \le s,d \le C)$
 -->
<span class="MATH">(1<img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>s</i>, <i>d</i><img src="Simplified%20GSM%20Network_files/3270img2.png" alt="$ \le$" align="middle" border="0" height="30" width="18"><i>C</i>)</span>, the source and destination cities.

</p><p>

</p><p>
<br>
No coordinate will have an absolute value greater than 1000. No two towers will be at the same location. No two
cities will be at the same location, and no city will lie on a cell boundary. No road will be coincident with a cell 
boundary, nor contain a point lying on the boundary of three or more cells. 

</p><p>

</p><p>
<br>
The input will end with a line containing four zeros.

</p><p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001002000000000000000">
Output</a>&nbsp;</font>
</h2>

<p>
For each input set, you should produce <span class="MATH"><i>Q</i> + 1</span> lines of output, as shown below. The first line should contain the 
number of the test case. <span class="MATH"><i>Q</i></span> lines should follow, one for each query, each containing an integer indicating the 
minimum number of switches required to go from city <span class="MATH"><i>s</i></span> to city <span class="MATH"><i>d</i></span>. If it is not possible to go from city <span class="MATH"><i>s</i></span> to city <span class="MATH"><i>d</i></span>,
print the line `<tt>Impossible</tt>' instead.

</p><p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001003000000000000000">
Sample Input</a>&nbsp;</font>
</h2>                                         

<p>
</p><pre>9 7 6 2
5 5                                                               
15 5                                                              
25 5
5 15 
15 15 
25 15 
5 25 
15 25 
25 25 
8 2 
22 3 
8 12 
18 18 
22 12 
28 16 
28 8 
1 2 
1 3 
2 5 
3 4 
4 5 
5 6 
1 6 
1 7 
0 0 0 0
</pre>  

<p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001004000000000000000">
Samle Output</a>&nbsp;</font>
</h2>

<p>
</p><pre>Case 1: 
3 
Impossible
</pre> 

<p>
</p><hr><address>Shanghai 2004-2005</address><p></p></body></html>