<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"><title>4121 - The Hare and the Hounds</title></head><body><table align="center" border="1" cellpadding="3" cellspacing="0"><tbody><tr valign="center"><td rowspan="2" align="center" valign="center"><font color="#0000a0" size="5"><b><img src="The%20Hare%20and%20the%20Hounds_files/icono.gif"></b></font></td><td colspan="5" align="center" width="500"><font color="#0000a0" size="5"><b>4121 - The Hare and the Hounds</b></font><br><a href="http://acmicpc-live-archive.uva.es/nuevoportal/region.php?r=wfi&amp;year=2007"><b>World Finals - Banff Springs, Alberta - 2007/2008</b></a></td></tr><tr valign="center"><td align="center" width="100"><a href="http://acmicpc-live-archive.uva.es/nuevoportal/data/p4121.pdf"><b>PDF</b></a></td><td width="100">&nbsp;</td><td align="center" width="100"><a href="http://acmicpc-live-archive.uva.es/nuevoportal/mailer.php?problem=4121"><b>Submit</b></a></td><td width="100">&nbsp;</td><td align="center" width="100"><a href="http://acmicpc-live-archive.uva.es/nuevoportal/rankprob.php?p=4121"><b>Ranking</b></a></td></tr></tbody></table><p>&nbsp;</p>
<p>
A <span class="textit">hare and hounds</span> road rally requires
contestants (the ``hounds") to identify a route of one or more roads
selected by the organizer (the ``hare"). Both parties move over roads
that meet at various intersections. Upon entering any intersection
(except special ones to be described shortly), both the hound and the
hare select routes using the <span class="textit">main road rule</span>.
The main road rule is always ``straight as possible," meaning make the
smallest turn (perhaps none) necessary to continue. If there are two
such choices possible (such as at some ``Y" intersections), the main
road rule dictates the rightmost (from the point of view of the hound)
of the two acceptable alternatives should be selected. </p><p>
At certain intersections, the hare may violate the main road rule by
taking a random road away from the intersection (though never the
original road used to reach the intersection). These intersections are
marked by the hare as <span class="textit">choice points</span>
(usually by a colored mark on the pavement in the intersection). When
reaching a choice point, the hound must try each road leaving the
intersection and travel that road (potentially traveling through other
intersections) until reaching a <span class="textit">confirmation marker</span>
(usually some flour dumped by the hare on the road) confirming the
correct route selection. An incorrect route selection is indicated by
one of the following: </p><p>

</p><ul>
<li>The hound travels a specified maximum distance from the choice point before reaching a confirmation marker. 
</li>
<li>The hound reaches a ``dead end" (an ``intersection" with only one road to it) before reaching the confirmation marker. 
</li>
<li>The hound reaches a choice point before reaching the confirmation
marker. (The hare always places a confirmation marker on the route
following a choice point. Also, the hare never returns to a previous
choice point.) </li>
</ul>

<p>
After detecting an incorrect route, the hound must trace back along the
route taken to the choice point and select a different route
alternative. If the hound encounters the endpoint while looking for a
confirmation marker, he ignores it. </p><p>
When selecting routes from a choice point, the hound uses the main road
rule in a slightly different way. The first road selected is the same
as if the intersection were not a choice point. But if the hound must
return to the choice point (i.e., the first road taken from the choice
point was not part of the hare's route), then the hound chooses the
second road using the main road rule from the direction with which he
returns to the choice point (ignoring any direction that he has already
tried as well as the direction that he originally arrived from). This
process repeats each time the hound returns to the choice point until
he finds the proper route. This multiple use of the main road rule
occurs only at choice points. For the purposes of this problem, the
hound will not remember the result of traveling down any road, even if
he returns to it multiple times while exploring one choice point. </p><p>
For this problem you will be given a road map (a configuration of roads
and intersections), the list of choice point intersections, the
placement of confirmation markers, the maximum distance from a choice
point to a confirmation marker, the starting and ending intersections
(neither of which will be choice points), and the direction to be used
in leaving the starting intersection. Using this information, you will
simulate the hound's search for the hare's route. You may assume that
the hound, using the strategy described, will always discover and trace
the hare's route. </p><p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001001000000000000000">
Input</a>&nbsp;</font>
</h2> 

<p>
There may be multiple input test cases. The data for each case begins with a line containing 7 integers: <span class="MATH"><i>ncp</i></span>
<tex2html_verbatim_mark> (number of choice point intersections), <span class="MATH"><i>nroad</i></span>
<tex2html_verbatim_mark> (number of roads, never larger than 150), <span class="MATH"><i>ncm</i></span>
<tex2html_verbatim_mark> (number of confirmation markers, never more than 100), <span class="MATH"><i>confdist</i></span>
<tex2html_verbatim_mark> (maximum distance from a choice point intersection to the confirmation marker, at most 2000), <!-- MATH
 $startisect$
 -->
<span class="MATH"><i>startisect</i></span>
<tex2html_verbatim_mark> (starting intersection number), <span class="MATH"><i>endisect</i></span>
<tex2html_verbatim_mark> (ending intersection number), and <span class="MATH"><i>startdir</i></span>
<tex2html_verbatim_mark> (the direction of the starting road). Intersections are identified using integers between 1 and 100.

</tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></p><p>
The starting line for each case is immediately followed by a line containing <span class="MATH"><i>ncp</i></span>
<tex2html_verbatim_mark> integers giving the identifying numbers of the choice point intersections. 

</tex2html_verbatim_mark></p><p>
Next there are <span class="MATH"><i>nroad</i></span>
<tex2html_verbatim_mark> lines. Roads are identified using sequential
integers starting with 1, matching the order in which their
specification lines appear in the input. Each such line contains 5
integers: the identifying numbers of the two intersections connected by
the road, the compass directions (from 0 to 359 degrees, 0 is north, 90
is east) with which the road leaves the intersections, and the length
of the road. Each road can be traveled in both directions and no two
roads will enter an intersection at the same angle. </tex2html_verbatim_mark></p><p>
Finally there are <span class="MATH"><i>ncm</i></span>
<tex2html_verbatim_mark> lines that identify the placement of the
confirmation markers. Each of these lines contains three integers
giving the identifying number of an intersection, the identifying
number of a road leaving that intersection, and the distance from the
intersection to the confirmation marker. Confirmation markers will not
be placed at intersections. Confirmation markers also will not be
dropped along roads that start/end in the same intersection. </tex2html_verbatim_mark></p><p>
Input for the last case is followed by a line containing 7 zeroes. 

</p><p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001002000000000000000">
Output</a>&nbsp;</font>
</h2> 

<p>
For each test case, print the case number (starting with 1), the length
of the hare's route, the length of the hound's search (including all
incorrect paths taken at choice points), and the road numbers in the
hare's route in the order the hare traveled them, using the format
shown in the sample data. Print a blank line after the output for each
case. </p><p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001003000000000000000">
Sample Input</a>&nbsp;</font>
</h2> 

<p>
</p><pre>1 5 1 3 3 1 180 
2 
2 4 180 0 5 
1 4 180 90 6 
4 2 270 270 5 
3 2 180 0 8 
1 2 270 90 3 
4 3 3 
0 0 0 0 0 0 0
</pre>

<p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001004000000000000000">
Sample Output</a>&nbsp;</font>
</h2>

<p>
</p><pre>Case 1: 
   Length of hare's route is 19 
   Length of hound's search is 31 
   Route: 4 3 2
</pre>

<p>
</p><hr><address>Banff Springs, Alberta 2007-2008</address><p><b>Tests-Setter:</b> Derek Kisman<br></p></body></html>