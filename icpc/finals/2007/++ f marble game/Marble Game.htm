<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"><title>3807 - Marble Game</title></head><body><table align="center" border="1" cellpadding="3" cellspacing="0"><tbody><tr valign="center"><td rowspan="2" align="center" valign="center"><font color="#0000a0" size="5"><b><img src="Marble%20Game_files/icono.gif"></b></font></td><td colspan="5" align="center" width="500"><font color="#0000a0" size="5"><b>3807 - Marble Game</b></font><br><a href="http://acmicpc-live-archive.uva.es/nuevoportal/region.php?r=wfi&amp;year=2006"><b>World Finals - Tokyo - 2006/2007</b></a></td></tr><tr valign="center"><td align="center" width="100"><a href="http://acmicpc-live-archive.uva.es/nuevoportal/data/p3807.pdf"><b>PDF</b></a></td><td width="100">&nbsp;</td><td align="center" width="100"><a href="http://acmicpc-live-archive.uva.es/nuevoportal/mailer.php?problem=3807"><b>Submit</b></a></td><td width="100">&nbsp;</td><td align="center" width="100"><a href="http://acmicpc-live-archive.uva.es/nuevoportal/rankprob.php?p=3807"><b>Ranking</b></a></td></tr></tbody></table><p>&nbsp;</p>
<p>
A Marble Game is played with <span class="MATH"><i>M</i></span>
<tex2html_verbatim_mark> marbles on a square board. The board is divided into <!-- MATH
 $N \times N$
 -->
<span class="MATH"><i>N</i>×<i>N</i></span>
<tex2html_verbatim_mark> unit squares, and <span class="MATH"><i>M</i></span>
<tex2html_verbatim_mark> of those unit squares contain holes. Marbles and holes are numbered from 1 to <span class="MATH"><i>M</i></span>
<tex2html_verbatim_mark>. The goal of the Marble game is to roll each marble into the hole that has the same number. 

</tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></p><p>
A game board may contain walls. Each wall is one unit long and stands
between two adjacent unit squares. Two squares are considered adjacent
if and only if they share a side. </p><p>
At the beginning of the game, all marbles are placed on the board, each
in a different square. A ``move" consists of slightly lifting a side of
the game board. Then all marbles on the board roll downward toward the
opposite side, each one rolling until it meets a wall or drops into an
empty hole, or until the next square is already occupied by another
marble. Marbles roll subject to the following restrictions: </p><p>

</p><ul>
<li>Marbles cannot jump over walls, other marbles, or empty holes. 
</li>
<li>Marbles cannot leave the board. (The edge of the board is a wall.) 
</li>
<li>A unit square can contain at most a single marble at any one time. 
</li>
<li>When a marble moves into a square with a hole, the marble drops
into that hole. The hole is then filled, and other marbles can
subsequently roll over the hole. A marble in a hole can never leave
that hole.
</li>
</ul>

<p>
The game is over when each marble has dropped into a hole with the corresponding number. 

</p><p>
The figure below illustrates a solution for a game played on a <!-- MATH
 $4 \times 4$
 -->
<span class="MATH">4×4</span>
<tex2html_verbatim_mark> board with three blue marbles, three holes and
a wall. The solution has five moves: lift the east side, lift the north
side, lift the south side, lift the west side, lift the north side. </tex2html_verbatim_mark></p><p>
Your program should determine the fewest number of moves to drop all
the marbles into the correct holes -- if such a move sequence is
possible.
</p><p>
</p><div align="center">
<!-- MATH
 $\epsfbox{p3807.eps}$
 -->
<img src="Marble%20Game_files/p3807.jpg" alt="\epsfbox{p3807.eps}" align="bottom" border="0">
<tex2html_verbatim_mark>
</tex2html_verbatim_mark></div>

<p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001001000000000000000">
Input</a>&nbsp;</font>
</h2>

<p>
The input file contains several test cases. The first line of each test case contains three numbers: the size <span class="MATH"><i>N</i></span>
<tex2html_verbatim_mark> <!-- MATH
 $(2 \le N \le 4)$
 -->
<span class="MATH">(2<img src="Marble%20Game_files/3807img2.png" alt="$ \le$" align="middle" border="0" height="31" width="18"><i>N</i><img src="Marble%20Game_files/3807img2.png" alt="$ \le$" align="middle" border="0" height="31" width="18">4)</span>
<tex2html_verbatim_mark> of the board, the number <span class="MATH"><i>M</i></span>
<tex2html_verbatim_mark> <span class="MATH">(<i>M</i> &gt; 0)</span>
<tex2html_verbatim_mark> of marbles, and the number <span class="MATH"><i>W</i></span>
<tex2html_verbatim_mark> of walls. Each of the following <span class="MATH">2<i>M</i></span>
<tex2html_verbatim_mark> lines contains two integers. The first integer is a row location and the second is a column location. The first <span class="MATH"><i>M</i></span>
<tex2html_verbatim_mark> of those lines represent the locations of the
marbles, where marble#1 is on the first line, marble#2 on the second,
and so on. The last <span class="MATH"><i>M</i></span>
<tex2html_verbatim_mark> of those lines represent the locations of the
holes, with the location of hole#1 coming first, hole#2 coming second,
and so on. Finally, the next <span class="MATH"><i>W</i></span>
<tex2html_verbatim_mark> lines represent the wall locations. Each of
those lines contains four integers: the first pair are the row and
column of the square on one side of the wall and the second pair are
the row and column of the square on the other side of the wall. Rows
and columns are numbered <span class="MATH">0..<i>N</i> - 1</span>
<tex2html_verbatim_mark>. 

</tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></tex2html_verbatim_mark></p><p>
The input file ends with a line containing three zeroes.

</p><p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001002000000000000000">
Output</a>&nbsp;</font>
</h2>

<p>
For each test case, print the case number (beginning with 1) and the
minimal number of moves to win the game. If the game cannot be won,
print the word ``<tt>impossible</tt>". Put a blank line after each test case. Use the format of the sample output below.

</p><p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001003000000000000000">
Sample Input</a>&nbsp;</font>
</h2>

<p>
</p><pre>4 3 1
0 1 
1 0 
1 2 
2 3 
2 1 
3 2 
1 1 1 2
3 2 2
0 0 
0 1 
0 2 
2 0 
2 0 1 0
2 0 2 1
0 0 0
</pre> 

<p>

</p><h2><font color="#ff0000" size="4"><a name="SECTION0001004000000000000000">
Sample Output</a>&nbsp;</font>
</h2>

<p>
</p><pre>Case 1: 5 moves 

Case 2: impossible
</pre> 

<p>
</p><hr><address>Tokyo 2006-2007</address><p><b>Tests-Setter:</b> Derek Kisman<br></p></body></html>